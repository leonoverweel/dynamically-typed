{{ define "main" }}

{{ $allIssues := where .Site.RegularPages ".Section" "in" "issues" }}
{{ $allStories := where .Site.RegularPages ".Section" "in" "stories" }}
{{ $allLinks := where .Site.RegularPages ".Section" "in" "quick-links" }}
{{ $categories := .Site.Data.categories }}

<div class="main cat-index">
    <p>
        <b>Welcome to Dynamically Typed!</b>
        I'm Leon, and DT is my fortnightly newsletter covering productized AI, ML research, climate AI, and cool things.
    </p>
</div>
<div class="wide">
    <div class="index-sections">
        {{ range sort .Site.Data.categories "index" }}
        {{ $content := where $.Site.Pages ".Params.category" .category }}
        <div class="cat-{{ .category }}-border">
            <h2 class="index-section-name">{{ .name }}</h2>
            <p class="index-section-description">{{ .descriptionShort }}</p>
            <a href="/" class="index-section-link cat-{{ .category }}-background">
                {{ len ($allStories | intersect $content) }} stories
            </a>
            <a href="/" class="index-section-link cat-{{ .category }}-background">
                {{ len ($content | complement $allStories) }} links
            </a>
        </div>
        {{ end }}
    </div>
</div>
<div class="main cat-index">
    <p>
        DT goes out every second Sunday &mdash;
        <a href="/issues">{{ len $allIssues }} issues</a> so far, featuring a total of
        {{ len $allStories }} stories and
        {{ len $allLinks }} links.
        Here's a few recent ones:
    </p>
    <ul>
        {{ range first 3 $allIssues }}
        <li>
            {{  .Params.date.Format "Jan 2" }} -
            <a href="{{ .URL }}">{{ safeHTML .Title }}</a>
        </li>
        {{ end }}
    </ul>
</div>

{{ end }}